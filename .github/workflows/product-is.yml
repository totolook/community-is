name: product-is-builder

on:
 push:
    branches:
        - master


env:
  MAVEN_OPTS: -Dhttp.keepAlive=false -Dmaven.wagon.http.pool=false -Dmaven.wagon.http.retryHandler.class=standard -Dmaven.wagon.http.retryHandler.count=3


jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: Clone the repo
        uses: actions/checkout@v3
      - name: Clone the Product is from WSO2
        uses: actions/checkout@v3
        with:
          repository: wso2/product-is
          path: wso2is
          ref: v6.1.0
      - name: Set up Adopt JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: "11"
          distribution: "adopt"
    
      - name: Restore Maven cache
        continue-on-error: true
        uses: skjolber/maven-cache-github-action@v1
        with:
          step: restore

      - name: Product-IS build with JDK 11 without Integration Tests
        run: |
          mvn clean install -f wso2is --batch-mode -Dmaven.test.skip=true | tee mvn-build.log
      - name: Restore Maven cache
        uses: skjolber/maven-cache-github-action@v1
        continue-on-error: true
        with:
          step: save
      - name: Upload Artifacts
        uses: actions/upload-artifact@v3
        with:
            name: wso2is-6.1.0
            path: wso2is/modules/distribution/target/*.zip
      